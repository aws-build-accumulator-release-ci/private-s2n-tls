# name: Test private action
# on:
#   # pull_request:
#   #   types: [opened, synchronize, reopened]
#   push:
#     branches-ignore:
#       - gh-pages
#   # schedule:
#   # Runs at 09:00 UTC Everyday
#   #   - cron:  '0 9 * * *'


# env:
#   CBMC_VERSION: 5.61.0
#   CBMC_VIEWER_VERSION: 3.6
#   LITANI_VERSION: 1.27.0
#   PROOFS_COMMAND: ./run-cbmc-proofs.py
#   PROOFS_DIR: tests/cbmc/proofs
#   CODEBUILD_COMPUTE_TYPE: BUILD_GENERAL1_2XLARGE
#   EXTERNAL_SAT_SOLVER: kissat


# jobs:
#   test-private-action:
#     name: Test private action
#     runs-on: ubuntu-latest
#     permissions:
#       contents: read
#       id-token: write
#       pull-requests: read
#     steps:
#       - name: Checkout proof-ci action
#         uses: actions/checkout@v3
#         with:
#           repository: ${{ secrets.PRIVATE_REPO_NAME }}
#           ref: refs/heads/bos-sept-13-2022
#           token: ${{ secrets.BOT_USER_PERSONAL_ACCESS_TOKEN }}
#           persist-credentials: false
#           path: .
#       - name: Test private action
#         uses: "./"
#         with:
#           # required
#           bot-user-personal-access-token: ${{ secrets.BOT_USER_PERSONAL_ACCESS_TOKEN }}
#           cbmc-version: ${{ env.CBMC_VERSION }}
#           cbmc-viewer-version: ${{ env.CBMC_VIEWER_VERSION }}
#           github-repo-owner: ${{ github.repository_owner }}
#           github-repo-name: ${{ fromJson(toJson(github.event.repository)).name }}
#           github-sha-from-event: ${{ github.event.after }}
#           github-repo-visibility: ${{ fromJson(toJson(github.event.repository)).visibility }}
#           github-token: ${{ secrets.GITHUB_TOKEN }}
#           iam-role: ${{ secrets.IAM_ROLE }}
#           litani-version: ${{ env.LITANI_VERSION }}
#           proof-container-image: ./actions/create-codebuild-docker-container/Dockerfile
#           proofs-command: ${{ env.PROOFS_COMMAND }}
#           proofs-dir: ${{ env.PROOFS_DIR }}
#           region: ${{ secrets.REGION }}
#           # not required
#           codebuild-compute-type: ${{ env.CODEBUILD_COMPUTE_TYPE }}
#           codebuild-environment-type: LINUX_CONTAINER
#           external-sat-solver: ${{ env.EXTERNAL_SAT_SOLVER }}


name: Test private action
on:
  pull_request:
    types: [opened, synchronize, reopened, labeled, unlabeled]
jobs:
  do-something:
    name: Test private action
    runs-on: ubuntu-latest
    permissions:
      contents: read
      id-token: write
      pull-requests: read
    steps:
      - name: Checkout proof-ci action
        uses: actions/checkout@v3
        with:
          repository: ${{ secrets.PRIVATE_REPO_NAME }}
          ref: refs/heads/bos-sept-13-2022
          token: ${{ secrets.BOT_USER_PERSONAL_ACCESS_TOKEN }}
          persist-credentials: false
          path: .
      - name: Test private action
        uses: "./"
        with:
          # required
          bot-user-personal-access-token: ${{ secrets.BOT_USER_PERSONAL_ACCESS_TOKEN }}
          cbmc-version: 5.61.0
          cbmc-viewer-version: 3.6
          github-repo-owner: ronakfof
          github-repo-name: private-s2n-tls
          github-sha-from-event: ${{ github.event.after }}
          github-repo-visibility: ${{ fromJson(toJson(github.event.repository)).visibility }}
          github-token: ${{ secrets.GITHUB_TOKEN }}
          iam-role: ${{ secrets.IAM_ROLE }}
          litani-version: 1.27.0
          proof-container-image: ./actions/create-codebuild-docker-container/Dockerfile
          proofs-command: ./run-cbmc-proofs.py
          proofs-dir: tests/cbmc/proofs
          region: us-east-1
          # not required
          codebuild-compute-type: BUILD_GENERAL1_2XLARGE
          codebuild-environment-type: LINUX_CONTAINER
          external-sat-solver: kissat

